<html>
<head>
  <script src="libs/RGraph.common.core.js"></script>
  <script src="libs/RGraph.hprogress.js"></script>
  <script src="libs/RGraph.hbar.js"></script>
  <link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body onload="init()">

<script>

var showdetails = false;

function init() {
  var limit = localStorage['limit'];
  var totalusage = localStorage['totalusage'];
  var unit = localStorage['unit'];
  var dailyusage = eval(localStorage['dailyusage']);
  var firstday = localStorage['firstday'];
  var lastday = localStorage['lastday'];
  var username = localStorage['username'];

  document.getElementById("h_title").innerHTML = 'Telemeter status for ' + username;
  document.getElementById("p_from").innerHTML = 'from ' + firstday;
  document.getElementById("p_to").innerHTML = 'to ' + lastday;
  document.getElementById("p_limit").innerHTML = 'limit: ' + limit + unit;
  document.getElementById("p_totalusage").innerHTML = 'total used: ' + totalusage + unit;

  var percentage = (totalusage/limit)*100; 
  drawGeneralProgress(percentage);

  drawDetail(dailyusage, unit);
}

function drawGeneralProgress(percentage) {
  var progress = new RGraph.HProgress('canvas_progress', percentage, 100);
  progress.Set('chart.tickmarks', true);
  progress.Set('chart.margin', 3);
  progress.Set('chart.tickmarks.inner', true);
  progress.Set('chart.label.inner', true);
  progress.Set('chart.min', 0);
  progress.Set('chart.units.post', '%');
  progress.Draw();
}

function drawDetail(dailyusage, unit) {
  var values = new Array();
  var dates = new Array();

  for (i = 0; i < dailyusage.length; i++) {
    var d = dailyusage[i];
    values[i] = parseInt(Math.random()*4000); //parseInt(dailyusage[i].usage);
    dates[i] = dailyusage[i].day.substr(5);
    console.log(values[i] + ' / ' + dates[i]);
  }

  var hbar = new RGraph.HBar('canvas_detail', values); 
  hbar.Set('chart.title.xaxis', 'Usage in ' + unit);
  hbar.Set('chart.title.yaxis', 'Date');
  hbar.Set('chart.background.barcolor1', '#ccc');
  hbar.Set('chart.background.barcolor2', '#ccc');
  hbar.Set('chart.background.grid.autofit', true);
  hbar.Set('chart.units.post', ' ' + unit);
  hbar.Set('chart.text.style', '#333');
  hbar.Set('chart.colors', ['red']);
  hbar.Set('chart.labels', dates);
  hbar.Set('chart.vmargin', 2);
  hbar.Set('chart.gutter', 25);
  hbar.Set('chart.labels.above', true);
  hbar.Draw();
}

function showmore() {
  showdetails = !showdetails; 
  var span = document.getElementById("seemore");
  var link = document.getElementById("showmorelink");
  
  if (showdetails) {
    span.setAttribute("class", "shown");
    link.innerHTML = "hide details";
  } else {
    span.setAttribute("class", "hidden");
    link.innerHTML = "show details";
  }
}

function report() {
  obj = new Object();
  obj.url = "https://github.com/vbsteven/Telenet-Telemeter-Chrome-extension/issues";
  chrome.tabs.create(obj);
}

</script>


<center><h1 id="h_title">Telemeter stats</h1>
<canvas id="canvas_progress" width="400px" height="75px"></canvas>
</center>
<p id="p_from" class="data"></p>
<p id="p_to" class="data"></p>
<p id="p_limit" class="data"></p>
<p id="p_totalusage" class="data"></p>
<p class="data" ><a href="#" id="showmorelink" onclick="showmore()">show details</a></p>
<span id="seemore" class="hidden">
<canvas id="canvas_detail" width="450px" height="600px"></canvas>
</span>
<p class="small"><a onclick="report()" href="">Report a bug or suggest a feature</a></p>
</body>
